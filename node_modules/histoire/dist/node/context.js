import { resolveConfig as resolveViteConfig } from 'vite';
import { resolveConfig } from './config.js';
import { mergeHistoireViteConfig } from './vite.js';
export async function createContext(options) {
    const config = await resolveConfig(process.cwd(), options.mode);
    const command = options.mode === 'dev' ? 'serve' : 'build';
    const viteConfig = await resolveViteConfig({}, command);
    const supportPlugins = config.plugins.map(p => p.supportPlugin).filter(Boolean);
    const ctx = {
        root: viteConfig.root,
        config,
        resolvedViteConfig: null,
        mode: options.mode,
        storyFiles: [],
        supportPlugins,
        markdownFiles: [],
    };
    ctx.resolvedViteConfig = await mergeHistoireViteConfig(viteConfig, ctx);
    return ctx;
}
